function animateClick(e,t){spinner(e);e.animate({opacity:.3},fadeOff,"swing").delay(fadeOn).animate({opacity:1},fadeOn,"swing")}function spinner(e){e.closest(".tile").find(".spinner").fadeIn("slow").delay(2e3).fadeOut("slow")}function setIcons(){$(".switch, .dimmer").append("<div class='icon inactive'><i class='fa fa-toggle-off'></i></div>").append("<div class='icon active'><i class='fa fa-toggle-on'></i></div>");$(".lock").append("<div class='icon inactive'><i class='fa fa-lock'></i></div>").append("<div class='icon active'><i class='fa fa-unlock-alt'></i></div>");$(".motion").append("<div class='icon inactive'><i class='fa opaque fa-exchange'></i></div>").append("<div class='icon active'><i class='fa fa-exchange'></i></div>");$(".presence").append("<div class='icon inactive'><i class='fa opaque fa-map-marker'></i></div>").append("<div class='icon active'><i class='fa fa-map-marker'></i></div>");$(".contact").append("<div class='icon inactive'><i class='r45 fa fa-compress'></i></div>").append("<div class='icon active'><i class='r45 fa fa-expand'></i></div>");$(".water").append("<div class='icon inactive'><i class='fa opaque fa-tint'></i></div>").append("<div class='icon active'><i class='fa fa-tint'></i></div>");$(".momentary").append("<div class='icon'><i class='fa fa-circle-o'></i></div>");$(".camera").append("<div class='icon'><i class='fa fa-camera'></i></div>");$(".holiday").append("<div class='icon'><i class='fa fa-tree'></i></div>");$(".refresh").append("<div class='icon'><i class='fa fa-refresh'></i></div>");$(".dimmer").each(function(){renderSlider($(this),1)});$(".music").each(function(){renderSlider($(this),0)});$(".weather").each(function(){renderWeather($(this))});$(".humidity").append("<div class='footer'><i class='fa fa-fw wi wi-sprinkles'></i></div>");$(".temperature").append("<div class='footer'><i class='fa fa-fw wi wi-thermometer'></i></div>");$(".energy").append("<div class='footer'><i class='fa fa-fw wi wi-lightning'></i></div>");$(".power").append("<div class='footer'><i class='fa fa-fw fa-bolt'></i></div>");$(".battery").append("<div class='footer'><span class='batt'></span></div>");$(".tile[data-is-value=true]").each(function(){renderValue($(this))})}function renderSlider(e,t){e.find(".slider-container").remove();e.append("<div class='slider-container'><div class='full-width-slider'><input value='"+e.attr("data-level")+"' min='"+t+"' max='10' type='range' step='1' data-mini='true' data-popup-enabled='true' data-disabled='false' data-highlight='true'></div></div>").find("input").slider();$(".full-width-slider").click(function(e){e.stopImmediatePropagation()})}function renderValue(e){e.find(".icon").remove();e.append("<div class='icon text'>"+e.attr("data-value")+"</div>")}function renderWeather(e){var t=JSON.parse(e.attr("data-weather"));e.empty();var n="<div class='title'>"+t.city+"<br/><span class='title2'>"+t.weather+", feels like "+t.feelsLike+"&deg;</span></div>\n<div class='icon'><span class='text'>"+t.temperature+"&deg;</span><i class='wi "+t.icon+"'></i></span></div>\n<div class='footer'>"+t.localSunrise+" <i class='fa fa-fw wi wi-horizon-alt'></i> "+t.localSunset+"</div>\n<div class='footer right'>"+t.percentPrecip+"%<i class='fa fa-fw fa-umbrella'></i><br>"+t.humidity+"%<i class='fa fa-fw wi wi-sprinkles'></i></div>";e.html(n)}function sendCommand(e,t,n,r){var i=getUrlParameter("access_token");var s={type:e,device:t,command:n,value:r};if(i)s["access_token"]=i;$.get("command",s).done(function(e){if(e.status=="ok"){nextPoll(5)}}).fail(function(){setWTFCloud();nextPoll(10)})}function doPoll(e){nextPoll(20);if(!e)spinner($(".refresh"));var t=getUrlParameter("access_token");var n={ts:stateTS};if(t)n["access_token"]=t;$.get("ping",n).done(function(t){clearWTFCloud();if(e){e()}else{stateTS=t.ts;$(".refresh .footer").html("Updated "+t.updated);if(t.status=="update")updateTiles(t.data)}}).fail(function(){setWTFCloud()})}function updateTiles(e){for(i in e)updateTile(e[i])}function updateTile(e){if(e.tile=="device"){var t=$("."+e.type+"[data-device="+e.device+"]");if(e.tile=="weather"){t.attr("data-weather",JSON.stringify(d));renderWeather(t)}else{if(e.value!=t.attr("data-value"))spinner(t);t.attr("data-value",e.value);if(e.isValue){renderValue(t)}else{t.removeClass("inactive active").addClass(e.active);t.attr("data-active",e.active)}if(e.type=="dimmer"){if(e.level!=t.attr("data-level"))spinner(t);t.attr("data-level",e.level);renderSlider(t,1)}else if(e.type=="music"){renderSlider(t,0)}}}else if(e.tile=="mode"){var t=$(".mode");if(e.mode!=t.attr("data-mode"))spinner(t);t.removeClass(t.attr("data-mode"));t.attr("data-mode",e.mode);if(e.isStandardMode)t.addClass(e.mode);$(".mode-name").html(e.mode)}}function setWTFCloud(){wtfCloud=true;$("#wtfcloud-popup").popup("open")}function clearWTFCloud(){wtfCloud=false;$("#wtfcloud-popup").popup("close")}function nextPoll(e){if(polling)clearInterval(polling);polling=setInterval(function(){doPoll()},e*1e3)}function refresh(e){if(!e){setTimeout(function(){doRefresh()},100)}else{setTimeout(function(){doRefresh()},e*1e3)}}function doRefresh(){doPoll(function(){$(".refresh .icon").addClass("fa-spin");location.reload()})}function getUrlParameter(e){var t=window.location.search.substring(1);var n=t.split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");if(i[0]==e){return i[1]}}}function startTime(){if(!document.getElementById("clock"))return;var e=new Date;var t=e.getHours();if(t>12){t=t-12}var n=e.getMinutes();var r=e.getSeconds();n=checkTime(n);r=checkTime(r);document.getElementById("clock").innerHTML=t+":"+n;setTimeout(function(){startTime()},500)}function checkTime(e){if(e<10){e="0"+e}return e}$(function(){$(".tile").append("<i class='spinner fa fa-refresh fa-spin'></i>");setIcons();$(".switch, .dimmer, .momentary, .clock, .lock, .link, .holiday, .camera").click(function(){animateClick($(this))});$(".switch, .lock, .momentary, .music .play, .music .pause, .holiday, .camera").click(function(){$(this).closest(".tile").toggleClass("active");sendCommand($(this).attr("data-type"),$(this).attr("data-device"),"toggle")});$(".dimmer").on("slidestop",function(e){var t=$(this).find("input").val();if($(this).hasClass("active")){animateClick($(this));sendCommand("dimmer",$(this).attr("data-device"),"level",t)}$(this).attr("data-value",t)});$(".dimmer").click(function(){$(this).toggleClass("active");sendCommand("dimmer",$(this).attr("data-device"),"toggle",$(this).attr("data-value"))});$(".mode, .hello-home, .thermostat").click(function(){$("#"+$(this).attr("data-popup")).popup("open")});$(".refresh, .clock").click(function(){refresh()});$("#mode-popup li").click(function(){$("#mode-popup").popup("close");var e=$(".mode");animateClick(e);var t=$(this).text();sendCommand("mode","mode",t);var n=$(".mode").attr("data-mode");e.removeClass(n);e.attr("data-mode",t);if(["Home","Away","Night"].indexOf(t)>=0){$("#mode-name").hide();e.addClass(t)}else{$("#mode-name").html(t).show()}});$("#hello-home-popup li").on("click",function(){$("#hello-home-popup").popup("close");animateClick($(".hello-home"));sendCommand("helloHome","helloHome",$(this).text())});startTime();$(".wtfcloud").click(function(){$("#wtfcloud-popup").popup("open")})});var fadeOn=100;var fadeOff=200;var polling;var wtfCloud=false;nextPoll(30);refresh(60*60);CoolClock.config.skins={st:{outerBorder:{lineWidth:12,radius:100,color:"yellow",alpha:0},smallIndicator:{lineWidth:16,startAt:80,endAt:85,color:"white",alpha:1},largeIndicator:{lineWidth:2,startAt:80,endAt:85,color:"white",alpha:1},hourHand:{lineWidth:8,startAt:0,endAt:60,color:"white",alpha:1},minuteHand:{lineWidth:6,startAt:0,endAt:75,color:"white",alpha:1},secondHand:{lineWidth:5,startAt:80,endAt:85,color:"red",alpha:0},secondDecoration:{lineWidth:3,startAt:96,radius:4,fillColor:"white",color:"black",alpha:1}},st1:{outerBorder:{lineWidth:2,radius:80,color:"white",alpha:0},smallIndicator:{lineWidth:5,startAt:88,endAt:94,color:"yellow",alpha:0},largeIndicator:{lineWidth:5,startAt:90,endAt:94,color:"white",alpha:1},hourHand:{lineWidth:8,startAt:0,endAt:60,color:"white",alpha:1},minuteHand:{lineWidth:8,startAt:0,endAt:80,color:"white",alpha:1},secondHand:{lineWidth:5,startAt:89,endAt:94,color:"white",alpha:1},secondDecoration:{lineWidth:3,startAt:0,radius:4,fillColor:"black",color:"black",alpha:0}}};var cellSize=getUrlParameter("t")||120;var cellGutter=getUrlParameter("g")||4;$(function(){var e=new freewall(".tiles");e.fitWidth();e.reset({draggable:false,selector:".tile",animate:true,gutterX:cellGutter,gutterY:cellGutter,cellW:cellSize,cellH:cellSize,fixSize:null,onResize:function(){e.fitWidth();e.refresh()}});e.fitWidth();$(window).trigger("resize")})